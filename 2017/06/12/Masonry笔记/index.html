<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Masonry笔记 | 小山河</title>
  <meta name="author" content="小山河">
  
  <meta name="description" content="##Masonry
统一的类别名 是 ```UIView```   12一些常用的宏见daily    通过为UIView添加类别的形式扩展了mas_的属性 和 主要的约束变更修改方法
mas_makeConstraints:       
mas_updateConstraints:
mas_re">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Masonry笔记"/>
  <meta property="og:site_name" content="小山河"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="小山河" type="application/atom+xml">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="/css/style.css">
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-368771XX-X']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class='normal_mode'>
    <nav id="main-nav">
  <ul class='container'>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
  </header>
  <div id="content" class="container">
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2017-06-12T04:02:01.000Z"><a href="/2017/06/12/Masonry笔记/">Mon, Jun 12 2017, 12:02:01 pm</a></time>

  
    <h1 class="title">Masonry笔记</h1>
  



<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>##Masonry</p>
<p>统一的类别名 <figure class="highlight plain"><figcaption><span>是 ```UIView```   </span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">一些常用的宏见daily    </div><div class="line">通过为UIView添加类别的形式扩展了mas_的属性 和 主要的约束变更修改方法</div></pre></td></tr></table></figure></p>
<pre><code>mas_makeConstraints:       
mas_updateConstraints:
mas_remakeConstraints:
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">类的结构关系</div><div class="line"></div><div class="line">![结构](./Masonry笔记/masonry-1.png)</div><div class="line"></div><div class="line"></div><div class="line">我们一般使用</div></pre></td></tr></table></figure>
<pre><code>UIView *view = [UIView new];
[self.view addSubview:view];
[view mas_makeConstraints:^(MASConstraintMaker *make) {
    make.top.mas_equalTo(self.view.mas_top);
    make.left.bottom.right.mas_equalTo(self.view);
}];
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">view 的 ```mas_makeConstraints``` 方法 是 MAS 扩展的类``` View+MASShorthandAdditions.h ``` 提供的。他其实是 ``` View+MASAdditions ``` 一个补充，提供一个便捷的访问方式。   </div><div class="line"></div><div class="line">具体看 ```mas_makeConstraints``` 方法</div></pre></td></tr></table></figure>
<ul>
<li>(NSArray <em>)mas_makeConstraints:(void(^)(MASConstraintMaker </em>))block {<br>  //autolayout 的开关<br>  self.translatesAutoresizingMaskIntoConstraints = NO;<br>  //构建者<br>  MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:self];<br>  //调用外部添加的约束 (见p1)<br>  block(constraintMaker);<br>  return [constraintMaker install];<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">p1: 处执行的代码</div></pre></td></tr></table></figure>
<p>make.top.mas_equalTo(self.view.mas_top);<br>make.left.bottom.right.mas_equalTo(self.view);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">这里``` make ```就是刚刚p1处的创建的构建者，他的top属性在```MASConstraintMaker``` 中实际上是创建了一个对象</div></pre></td></tr></table></figure></p>
<p>step: 1</p>
<ul>
<li>(MASConstraint *)top {<br>  return [self addConstraintWithLayoutAttribute:NSLayoutAttributeTop];<br>}<br>step: 2</li>
<li>(MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute {<br>  return [self constraint:nil addConstraintWithLayoutAttribute:layoutAttribute];<br>}<br>step:3<br>这个方法是在构造者的对象中</li>
<li>(MASConstraint <em>)constraint:(MASConstraint </em>)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute{<br>  //这里根据开始传进来的view 创建<code>MASViewAttribute</code><br>  //接着包装成<code>MASViewConstraint</code> 这个类是<code>MASConstraint</code> 的子类<br>  //最后把这个对象放到maker这个构造者的<code>constraints</code>数组当中<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">上面make.top返回了一个```MASConstraint ```的对象，接着调用了```mas_equalTo```这个方法，```mas_equalTo```是一个宏```equalTo(MASBoxValue((__VA_ARGS__))) ```  </div><div class="line"></div><div class="line">其中```MASBoxValue ```一会看    </div><div class="line">``equalTo()``可能出现的参数大概有几种</div><div class="line"></div><div class="line">|index |value  | type |</div><div class="line">|:----:|:-----:|:----:|</div><div class="line">|1     |@(1)  | NSNumber |</div><div class="line">|2     |view.mas_top  | MASViewAttribute |</div><div class="line">|3     | view  | MAS_VIEW |</div><div class="line"></div><div class="line">那么刚刚```MASBoxValue```做了什么？</div></pre></td></tr></table></figure>
<p>tips:<br>    @encode<br>    编译器指令，返回一个给定类型编码为一种内部表示的字符串<br>    类似于typeof<br>extend:<br>@ —&gt; An object (whether statically typed or typed id)</p>
<h1 id="—-gt-A-class-object-Class"><a href="#—-gt-A-class-object-Class" class="headerlink" title="—&gt; A class object (Class)"></a>—&gt; A class object (Class)</h1><p>sample code:<br>A *a = A.new;</p>
<ul>
<li>@encode(typeof(a))—&gt;@</li>
<li>@encode(typeof(A))—&gt;{ A =# }<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">```MASBoxValue```对数值型、坐标型的```__VA_ARGS__```进行了```NSValue```的包装    </div><div class="line">回去看```equalTo()```方法，他是```MASConstraint ```的实力调用的，因为在创建的时候是返回的一个```MASViewConstraint```的父类指针引用，所以最终他还是调用的子类```MASViewConstraint```的```equalTo```方法</div></pre></td></tr></table></figure>
</li>
</ul>
<p>in file MASConstraint.m </p>
<ul>
<li><p>(MASConstraint * (^)(id))equalTo {<br>  return ^id(id attribute) {</p>
<pre><code>return self.equalToWithRelation(attribute, NSLayoutRelationEqual);
</code></pre><p>  };<br>}</p>
</li>
<li><p>(MASConstraint * (^)(id, NSLayoutRelation))equalToWithRelation { MASMethodNotImplemented(); }</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">返回的是一个函数，这个函数可以返回```MASConstraint```对象</div></pre></td></tr></table></figure>
<p>in MASViewConstraint.m file</p>
<ul>
<li>(MASConstraint * (^)(id, NSLayoutRelation))equalToWithRelation {<br>  return ^id(id attribute, NSLayoutRelation relation) {<pre><code>// |==============================================|
// |make.height.equalTo(@[greenView, blueView]);  |
// |多个view的约束可能会传进数组                      |
// |循环做了else的操作                              |
// |==============================================|
if ([attribute isKindOfClass:NSArray.class]) {
    NSAssert(!self.hasLayoutRelation, @&quot;Redefinition of constraint relation&quot;);
    NSMutableArray *children = NSMutableArray.new;
    for (id attr in attribute) {
        MASViewConstraint *viewConstraint = [self copy];
        viewConstraint.layoutRelation = relation;
        viewConstraint.secondViewAttribute = attr;
        [children addObject:viewConstraint];
    }
    MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];
    compositeConstraint.delegate = self.delegate;
    [self.delegate constraint:self shouldBeReplacedWithConstraint:compositeConstraint];
    return compositeConstraint;
} else {
    NSAssert(!self.hasLayoutRelation || self.layoutRelation == relation &amp;&amp; [attribute isKindOfClass:NSValue.class], @&quot;Redefinition of constraint relation&quot;);
    self.layoutRelation = relation;
    self.secondViewAttribute = attribute;
    return self;
}
</code></pre>  };<br>}</li>
</ul>
<p><code>`
这里</code>MASCompositeConstraint<code>等一下看  
就把约束和关系加到</code>MASConstraint``中了</p>
<p>构建者maker 最后在调用<code>install</code> 当中会根据调用函数是<code>remake、update、make</code>来做约束<code>uninstall</code>的更新。在遍历当前<code>constraints</code>数组中的约束调用他的<code>install</code> (同<code>equalTo</code>)类似，是子类<code>MASViewConstraint</code> 中</p>
<p>下次写<br>下班。。。</p>

      
    </div>
    <footer>
      
          
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <span class="jiathis_txt">分享到：</span>
  <a class="jiathis_button_weixin">微信</a>
  <a class="jiathis_button_tsina">新浪微博</a>
  <a class="jiathis_button_renren">人人网</a>
  <a class="jiathis_button_qzone">QQ空间</a>
  <a class="jiathis_button_douban">豆瓣</a>
  <a class="jiathis_button_pocket">Pocket</a>
  <a href="http://www.jiathis.com/share?uid=901656" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js?uid=901656" charset="utf-8"></script>
<!-- JiaThis Button END -->

          <div class="clearfix"></div>
          <nav id="pagination">
  
  
    <a href="/2017/05/22/markdown入门/" class="alignright next">Prev<i class="fa fa-long-arrow-right"></i></a>
  
  <div class="clearfix"></div>
</nav>
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Kommentare</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>



    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div>
  
  &copy; 2017 小山河
  
</div>
Powered by <a href="http://zespia.tw/hexo/" title="Hexo" target="_blank" rel="external">Hexo</a> and <a href="http://pages.github.com/" title="GitHub Pages" target="_blank" rel="external">GitHub Pages</a>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="clearfix"></div>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span></footer>
  
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>


<script type="text/javascript">
var disqus_shortname = 'zjbpha';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



    <script type="text/javascript">
        (function(){

            $(window).scroll(function(){

                var scrollTop = $(window).scrollTop();
                if ( scrollTop >200 ){
                    $("#main-nav").removeClass('normal_mode').addClass('top_mode');
                } else{
                    $("#main-nav").removeClass('top_mode').addClass('normal_mode');
                }

            });

        })();
    </script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
  (function($){
    $('.fancybox').fancybox({
      'titlePosition': 'inside'
    });
  })(jQuery);
  </script>




<script type="text/javascript">
  
  $(function(){

    $('.title').hover(
      function() {      
        $(this).stop().animate(
          {'marginLeft': '10px'}, 200
        );   
      }, 
      function() {       
        $(this).stop().animate({'marginLeft': '0px'}, 200);      
      
    });   

  });

</script>


</body>
</html>